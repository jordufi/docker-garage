version: "3.8"

services:
  controller:
    build:
      context: ./controller
      dockerfile: Dockerfile
    container_name: homeserver-controller
    restart: unless-stopped
    ports:
      - "${CONTROLLER_PORT:-8081}:8081"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ${APPS_DIR:-./apps}:/apps
    environment:
      - APPS_DIR=/apps
      - HOST_APPS_DIR=${HOST_APPS_DIR:-}
    networks:
      - homeserver

  ui:
    build:
      context: ./ui
      dockerfile: Dockerfile
    container_name: homeserver-ui
    restart: unless-stopped
    ports:
      - "${UI_PORT:-8080}:80"
    depends_on:
      - controller
    networks:
      - homeserver

networks:
  homeserver:
    driver: bridge
